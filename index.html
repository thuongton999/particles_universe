<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content=#000000><meta property=og:url content=https://thuongton999.github.io/particles_universe/ ><meta property=og:image content=./src/og-image.png><title>Heart Particles</title><script>var sdf="\n\n  float sdSphere( vec3 p, float s )\n  {\n    return length(p)-s;\n  }\n  mat3 rotationMatrix(vec3 m,float a) {\n      m = normalize(m);\n      float c = cos(a),s=sin(a);\n      return mat3(\n        c+(1.-c)*m.x*m.x,     (1.-c)*m.x*m.y-s*m.z, (1.-c)*m.x*m.z+s*m.y,\n        (1.-c)*m.x*m.y+s*m.z, c+(1.-c)*m.y*m.y,     (1.-c)*m.y*m.z-s*m.x,\n        (1.-c)*m.x*m.z-s*m.y, (1.-c)*m.y*m.z+s*m.x, c+(1.-c)*m.z*m.z);\n  }\n  \n  mat3 rotate(vec3 val){\n    mat3 matX = rotationMatrix(vec3(1, 0, 0), val.x);\n    mat3 matY = rotationMatrix(vec3(0, 1, 0), val.y);\n    mat3 matZ = rotationMatrix(vec3(0, 0, 1), val.z);\n    return matX * matY * matZ;\n  }\n"</script><script type=module>import*as THREE from"https://cdn.skypack.dev/three@0.136.0";import{OrbitControls}from"https://cdn.skypack.dev/three@0.136.0/examples/jsm/controls/OrbitControls";import{FontLoader}from"https://cdn.skypack.dev/three@0.136.0/examples/jsm/loaders/FontLoader";import{TextGeometry}from"https://cdn.skypack.dev/three@0.136.0/examples/jsm/geometries/TextGeometry";let scene=new THREE.Scene;scene.background=new THREE.Color(1441814);let camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,1,1e3);camera.position.set(0,4,21);let renderer=new THREE.WebGLRenderer({antialias:!0});renderer.setSize(innerWidth,innerHeight),document.body.appendChild(renderer.domElement),window.addEventListener("resize",(e=>{camera.aspect=innerWidth/innerHeight,camera.updateProjectionMatrix(),renderer.setSize(innerWidth,innerHeight)}));let controls=new OrbitControls(camera,renderer.domElement);controls.enableDamping=!0,controls.enablePan=!1;let time=0,sizes=[],shift=[],pts=new Array(5e4).fill().map((e=>(sizes.push(1.5*Math.random()+.5),shift.push(Math.random()*Math.PI,Math.random()*Math.PI*2,(.9*Math.random()+.1)*Math.PI*.1,.9*Math.random()+.1),(new THREE.Vector3).randomDirection().multiplyScalar(.5*Math.random()+9.5)))),galaxySize=50,np=1e5;for(let e=0;e<np;e++){let t=e/np,n=THREE.Math.randFloatSpread(.5),a=t*Math.PI*galaxySize+n,r=THREE.Math.randFloatSpread(.05),o=t*galaxySize;pts.push(new THREE.Vector3(o*Math.sin(a)*Math.cos(r),o*Math.sin(a)*Math.sin(r)*.5,o*Math.cos(a))),sizes.push(1.5*Math.random()+.5),shift.push(Math.random()*Math.PI,Math.random()*Math.PI*2,(.9*Math.random()+.1)*Math.PI,.9*Math.random()+.1)}let galaxyGeometry=(new THREE.BufferGeometry).setFromPoints(pts);galaxyGeometry.setAttribute("sizes",new THREE.Float32BufferAttribute(sizes,1)),galaxyGeometry.setAttribute("shift",new THREE.Float32BufferAttribute(shift,4));let galaxyMaterial=new THREE.PointsMaterial({size:.125,transparent:!0,depthTest:!1,blending:THREE.AdditiveBlending,onBeforeCompile:e=>{e.uniforms.time=time,e.vertexShader=`\n  uniform float time;\n  attribute float sizes;\n  attribute vec4 shift;\n  varying vec3 vColor;\n  ${e.vertexShader}\n  `.replace("gl_PointSize = size;","gl_PointSize = size * sizes;").replace("#include <color_vertex>","#include <color_vertex>\n      float d = length(abs(position) / vec3(40., 10., 40));\n      d = clamp(d, 0., 1.);\n      vColor = mix(vec3(227., 155., 0.), vec3(100., 50., 255.), d) / 255.;").replace("#include <begin_vertex>","#include <begin_vertex>\n      float t = time;\n      float moveT = mod(shift.x + shift.z * t, PI2);\n      float moveS = mod(shift.y + shift.z * t, PI2);\n      transformed += vec3(cos(moveS) * sin(moveT), cos(moveT), sin(moveS) * sin(moveT)) * shift.a;"),e.fragmentShader=`\n  varying vec3 vColor;\n  ${e.fragmentShader}\n  `.replace("#include <clipping_planes_fragment>","#include <clipping_planes_fragment>\n      float d = length(gl_PointCoord.xy - 0.5);").replace("vec4 diffuseColor = vec4( diffuse, opacity );","vec4 diffuseColor = vec4( vColor, smoothstep(0.5, 0.1, d)/* * 0.5 + 0.5*/ );")}}),galaxy=new THREE.Points(galaxyGeometry,galaxyMaterial);galaxy.rotation.z=.2,scene.add(galaxy);let positions=[],speed=[],xSize=75,ySize=75,zSize=75,n=xSize*ySize*zSize;for(let e=0;e<n;e++){let e=Math.random(),t=Math.random(),n=Math.random();positions.push(new THREE.Vector3(e,t,n).multiplyScalar(100)),speed.push(10*Math.random()+5)}let heartGeometry=(new THREE.BufferGeometry).setFromPoints(positions);heartGeometry.setAttribute("speed",new THREE.BufferAttribute(new Float32Array(speed),1)),heartGeometry.center();let heartMaterial=new THREE.ShaderMaterial({blending:THREE.AdditiveBlending,depthTest:!1,transparent:!0,uniforms:{time:{value:0},size:{value:.125}},vertexShader:`\n#define PI 3.1415926  \n\nuniform float time;\nuniform float size;\n\nattribute float speed;\n\nvarying vec3 vC;\nvarying float vDiscard;\n${sdf}\nvoid main(){\nvec3 pos = position;\n\nfloat start = position.y +50.;\nfloat way = speed * time;\nfloat totalWay = start + way;\nfloat modulo = mod(totalWay, 100.);\npos.y = modulo - 50.;\n\nvec3 vPos = pos;\n\nvPos *= rotate(vec3(0, time, 0));\nvec3 h = vPos / 2.5;\nh.y = 4. + 1.2 * h.y - abs(h.x) * sqrt(max((20. - abs(h.x)) / 15., 0.));\nh.z = h.z * (2. - h.y / 15.);\nfloat r = 15. + 3. * pow(0.5 + 0.5 * sin(2. * PI * time + h.y / 25.), 4.);\nfloat heart = sdSphere(h, r);        \n\nbool boolDiscard = heart > 0.0 || heart < -2.;\n\nvec3 c = vec3(1.,0.412,0.706); // colour of the heart\nif (heart > -0.125) c = vec3(1);\n\nvC = c;        \nvDiscard = boolDiscard == true ? 1. : 0.;\n\nvec4 mvPosition = modelViewMatrix * vec4( pos, 1.0 );\ngl_PointSize = size * ( 300.0 / -mvPosition.z );\ngl_Position = projectionMatrix * mvPosition;\n}\n`,fragmentShader:"\nvarying vec3 vC;\nvarying float vDiscard;\n\nvoid main(){\nif ( vDiscard > 0.5 ) {discard;}\nif (length(gl_PointCoord - 0.5) > 0.5) {discard;}\ngl_FragColor = vec4( vC, 1.0);\n}\n"}),heart=new THREE.Points(heartGeometry,heartMaterial);heart.rotation.z=.2,heart.scale.set(.2,.2,.2),scene.add(heart);const loader=new FontLoader,typeface="https://dl.dropboxusercontent.com/s/75v35gd64dzjthq/Sacramento_Regular.json";loader.load(typeface,(e=>{const t=new TextGeometry("Love You",{font:e,size:5,height:5,curveSegments:10});t.center();let n=[];for(let e=0;e<t.attributes.position.count;e++){let a=t.attributes.position.getX(e),r=t.attributes.position.getY(e);n.push(new THREE.Vector2(a,r))}let a=(new THREE.BufferGeometry).setFromPoints(n),r=new THREE.Mesh(a,new THREE.MeshBasicMaterial({color:16425120,side:THREE.DoubleSide}));r.rotation.z=.2,r.position.y=15,scene.add(r)}));let clock=new THREE.Clock;renderer.setAnimationLoop((()=>{controls.update();let e=.5*clock.getElapsedTime();time=e*Math.PI,heart.material.uniforms.time.value=time,scene.rotation.y=.05*e,renderer.render(scene,camera)}))</script><style>body,html{height:100%;margin:0;overflow:hidden;text-align:center}canvas{width:100%;height:100%;display:block}</style></head><body></body></html>
